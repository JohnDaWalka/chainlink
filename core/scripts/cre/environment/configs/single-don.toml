
[[blockchains]]
  type = "anvil"
  chain_id = "1337"
  docker_cmd_params = ["-b", "5"]

# uncomment to start a second blockchain
[[blockchains]]
  type = "anvil"
  chain_id = "2337"
  port = "8546"
  docker_cmd_params = ["-b", "5"]

[jd]
  # change to your version
  csa_encryption_key = "d1093c0060d50a3c89c189b2e485da5a3ce57f3dcb38ab7e2c0d5f0bb2314a44" # any random 32 byte hex string
  image = "job-distributor:0.12.7"

#[s3provider]
#  # use all defaults
#  port = 9000
#  console_port = 9001

[infra]
  # either "docker" or "crib"
  type = "docker"

#[infra.crib]
#  namespace = "crib-local"
#  folder_location = "/absolute/path/to/crib/deployments/cre"
#  provider = "kind"  # or "aws"

[additional_capabilities.cron]
  binary_path = "./cron"

# Global config for cron is optional - uses empty config by default
# [additional_capabilities.cron.config]
#   CustomField = "value"  # Add custom fields if needed

[additional_capabilities.log_event_trigger]
  binary_path = "./logtrigger"
  chains = ["1337", "2337"]

# Global config for log event trigger (REQUIRED - all values must be specified)
[additional_capabilities.log_event_trigger.config]
  LookbackBlocks = 2000        # Default lookback blocks
  PollPeriod = 1500            # Default poll period in milliseconds

# Chain-specific overrides for log event trigger
[additional_capabilities.log_event_trigger.chain_configs."1337"]
  ChainID = 1337
  NetworkFamily = "evm"   # Explicit network family for chain

[additional_capabilities.log_event_trigger.chain_configs."2337"]
  ChainID = 2337
  NetworkFamily = "evm"    # Explicit network family for chain
  LookbackBlocks = 3000        # Override for chain
  PollPeriod = 1000            # Override for chain

[additional_capabilities.evm]
  binary_path = "./evm"
  chains = "1337" # will be intialised only for this chain

# Global config for all chains (REQUIRED - no hardcoded defaults in code)
[additional_capabilities.evm.config]
  LogTriggerPollInterval = 1500000000  # 1.5s in nanoseconds - applies to all chains
  ReceiverGasMinimum = 500             # global default
  # Runtime values like ChainID, NetworkFamily, CreForwarderAddress, NodeAddress
  # are auto-filled if not specified, but can be overridden here if needed

# Chain-specific overrides (optional)
[additional_capabilities.evm.chain_configs."1337"]
  ChainID = 1337
  LogTriggerPollInterval = 2000000000  # 2s in nanoseconds - overrides global for chain
  ReceiverGasMinimum = 1000            # overrides global for chain
  # Example: Override runtime values with pre-deployed contracts:
  # CreForwarderAddress = "0x1234567890123456789012345678901234567890"
  # NodeAddress = "0x0987654321098765432109876543210987654321"

# Read Contract Capability Configuration
[additional_capabilities.read_contract]
  binary_path = "./readcontract"
  chains = "1337, 2337"

# Chain-specific overrides for read contract
[additional_capabilities.read_contract.chain_configs."1337"]
  ChainID = 1337
  NetworkFamily = "evm"   # Explicit network family for chain

[additional_capabilities.read_contract.chain_configs."2337"]
  ChainID = 2337
  NetworkFamily = "evm"    # Explicit network family for chain

# Mock Capability Configuration
#[additional_capabilities.mock]
#  binary_path = "mock"

# Global config for mock capability (optional - uses runtime port by default)
#[additional_capabilities.mock.config]
#  Port = 8080  # Port for mock service

[[nodesets]]
  nodes = 5
  override_mode = "each"
  http_port_range_start = 10100
  name = "workflow"

  [nodesets.db]
    image = "postgres:12.0"
    port = 13000

  [[nodesets.node_specs]]
    [nodesets.node_specs.node]
      docker_ctx = "../../../.."
      docker_file = "core/chainlink.Dockerfile"
      # image = "chainlink-tmp:latest"
      # omitted on purpose, if not defined here it will be added by Go code if worker nodes from this DON have cron capability
      # capabilities = ['./cron']
      custom_ports = ["5002:5002"]
      user_config_overrides = """
      [Log]
      Level = 'debug'
      JSONConsole = true

      [Telemetry]
      Enabled = true
      Endpoint = 'host.docker.internal:4317'
      ChipIngressEndpoint = 'chip-ingress:50051'
      InsecureConnection = true
      TraceSampleRatio = 1
      HeartbeatInterval = '30s'

      # Remove this bit to allow downloading workflows from remote sources
      [CRE.WorkflowFetcher]
      URL = "file:///home/chainlink/workflows"
      """
      [nodesets.node_specs.node.env_vars]
      CL_EVM_CMD=""

  [[nodesets.node_specs]]
    [nodesets.node_specs.node]
      docker_ctx = "../../../.."
      docker_file = "core/chainlink.Dockerfile"
      # image = "chainlink-tmp:latest"
      # omitted on purpose, if not defined here it will be added by Go code if worker nodes from this DON have cron capability
      # capabilities = ['./cron']
      user_config_overrides = """
      [Log]
      Level = 'debug'
      JSONConsole = true

      [Telemetry]
      Enabled = true
      Endpoint = 'host.docker.internal:4317'
      ChipIngressEndpoint = 'chip-ingress:50051'
      InsecureConnection = true
      TraceSampleRatio = 1
      HeartbeatInterval = '30s'

      # Remove this bit to allow downloading workflows from remote sources
      [CRE.WorkflowFetcher]
      URL = "file:///home/chainlink/workflows"
      """
      [nodesets.node_specs.node.env_vars]
      CL_EVM_CMD=""

  [[nodesets.node_specs]]
    [nodesets.node_specs.node]
      docker_ctx = "../../../.."
      docker_file = "core/chainlink.Dockerfile"
      # image = "chainlink-tmp:latest"
      # omitted on purpose, if not defined here it will be added by Go code if worker nodes from this DON have cron capability
      # capabilities = ['./cron']
      user_config_overrides = """
      [Log]
      Level = 'debug'
      JSONConsole = true

      [Telemetry]
      Enabled = true
      Endpoint = 'host.docker.internal:4317'
      ChipIngressEndpoint = 'chip-ingress:50051'
      InsecureConnection = true
      TraceSampleRatio = 1
      HeartbeatInterval = '30s'

      # Remove this bit to allow downloading workflows from remote sources
      [CRE.WorkflowFetcher]
      URL = "file:///home/chainlink/workflows"
      """
      [nodesets.node_specs.node.env_vars]
      CL_EVM_CMD=""

  [[nodesets.node_specs]]
    [nodesets.node_specs.node]
      docker_ctx = "../../../.."
      docker_file = "core/chainlink.Dockerfile"
      # image = "chainlink-tmp:latest"
      # omitted on purpose, if not defined here it will be added by Go code if worker nodes from this DON have cron capability
      # capabilities = ['./cron']
      user_config_overrides = """
      [Log]
      Level = 'debug'
      JSONConsole = true

      [Telemetry]
      Enabled = true
      Endpoint = 'host.docker.internal:4317'
      ChipIngressEndpoint = 'chip-ingress:50051'
      InsecureConnection = true
      TraceSampleRatio = 1
      HeartbeatInterval = '30s'

      # Remove this bit to allow downloading workflows from remote sources
      [CRE.WorkflowFetcher]
      URL = "file:///home/chainlink/workflows"
      """
      [nodesets.node_specs.node.env_vars]
      CL_EVM_CMD=""

  [[nodesets.node_specs]]
    [nodesets.node_specs.node]
      docker_ctx = "../../../.."
      docker_file = "core/chainlink.Dockerfile"
      # image = "chainlink-tmp:latest"
      # omitted on purpose, if not defined here it will be added by Go code if worker nodes from this DON have cron capability
      # capabilities = ['./cron']
      user_config_overrides = """
      [Log]
      Level = 'debug'
      JSONConsole = true

      [Telemetry]
      Enabled = true
      Endpoint = 'host.docker.internal:4317'
      ChipIngressEndpoint = 'chip-ingress:50051'
      InsecureConnection = true
      TraceSampleRatio = 1
      HeartbeatInterval = '30s'

      # Remove this bit to allow downloading workflows from remote sources
      [CRE.WorkflowFetcher]
      URL = "file:///home/chainlink/workflows"
      """
      [nodesets.node_specs.node.env_vars]
      CL_EVM_CMD=""

[[blockchains]]
  type = "anvil"
  chain_id = "1337"
  docker_cmd_params = ["-b", "5"]

[[blockchains]]
  type = "anvil"
  chain_id = "2337"
  port = "8546"
  docker_cmd_params = ["-b", "5"]

[jd]
  # change to your version
  csa_encryption_key = "d1093c0060d50a3c89c189b2e485da5a3ce57f3dcb38ab7e2c0d5f0bb2314a44" # any random 32 byte hex string
  image = "job-distributor:0.12.7"

[fake]
  port = 8171

#[s3provider]
#  # use all defaults
#  port = 9000
#  console_port = 9001

[infra]
  # either "docker" or "crib"
  type = "docker"

#[infra.crib]
#  namespace = "crib-local"
#  folder_location = "/absolute/path/to/crib/deployments/cre"
#  provider = "kind"  # or "aws"

[[nodesets]]
  nodes = 5
  name = "workflow"
  don_types = ["workflow", "gateway"]
  override_mode = "each"
  http_port_range_start = 10100

  # index of node in the nodeset that will act as the bootsrap node (not required, but added for visiblity)
  bootstrap_node_index = 0
  # added for visiblity, required always, when don_types include "gateway"
  gateway_node_index = 0

  env_vars = { CL_EVM_CMD = "" }

  capabilities = ["ocr3", "custom-compute", "web-api-target", "web-api-trigger", "vault"]

  # Enable capabilities per chain with optional per-chain overrides
  [nodesets.chain_capabilities]
    # Simple: enable write-evm on listed chains
    write-evm = ["1337", "2337"]
    # write-evm with per-chain configuration overrides
    # "write-evm" = { enabled_chains = ["1337", "2337"], chain_overrides = { "1337" = { GasLimitDefault = 500_000, PollPeriod = "1s", AcceptanceTimeout = "45s" }, "2337" = { GasLimitDefault = 300_000, AcceptanceTimeout = "60s" } } }
    # EVM capability with a chain-specific override example
    # evm = { enabled_chains = ["1337"], chain_overrides = { "1337" = { ReceiverGasMinimum = 1000 } } }
    # Read contract capability
    # read-contract = ["1337", "2337"]
    # Log trigger capability
    # log-trigger = ["1337", "2337"]

  # Override global capability configuration per DON
  #[nodesets.capability_overrides]
  #  # Override web-api-target rate limiter settings for this specific DON
  #  [nodesets.capability_overrides.web-api-target]
  #    GlobalRPS = 2000.0      # Override default 1000.0
  #    GlobalBurst = 2000      # Override default 1000
  #    PerSenderRPS = 1500.0   # Override default 1000.0
  #    PerSenderBurst = 1500   # Override default 1000
  #
  #  # Override web-api-trigger settings (empty by default)
  #  [nodesets.capability_overrides.web-api-trigger]
  #    CustomTriggerField = "don-specific-value"
  #
  #  # Override cron capability settings (empty by default)
  #  [nodesets.capability_overrides.cron]
  #    CustomCronField = "don-specific-cron-value"
  #    ScheduleOverride = "*/5 * * * *"  # Every 5 minutes for this DON
  #
  #  # Override mock capability settings
  #  [nodesets.capability_overrides.mock]
  #    Port = 8081  # Override default port for this DON

# [nodesets.capability_overrides.http-action]
#    IncomingGlobalBurst = 20

  [nodesets.db]
    image = "postgres:12.0"
    port = 13000

  [[nodesets.node_specs]]
    [nodesets.node_specs.node]
      docker_ctx = "../../../.."
      docker_file = "core/chainlink.Dockerfile"
      #image = "chainlink-tmp:latest"
      # 5002 is the web API capabilities port for incoming requests
      # 15002 is the vault port for incoming requests
      custom_ports = ["5002:5002","15002:15002"]
      user_config_overrides = """
      [Log]
      Level = 'debug'
      JSONConsole = true

      [Telemetry]
      Enabled = true
      Endpoint = 'host.docker.internal:4317'
      ChipIngressEndpoint = 'chip-ingress:50051'
      InsecureConnection = true
      TraceSampleRatio = 1
      HeartbeatInterval = '30s'

      # Remove this bit to allow downloading workflows from remote sources
      [CRE.WorkflowFetcher]
      URL = "file:///home/chainlink/workflows"
      """

  [[nodesets.node_specs]]
    [nodesets.node_specs.node]
      docker_ctx = "../../../.."
      docker_file = "core/chainlink.Dockerfile"
      #image = "chainlink-tmp:latest"
      user_config_overrides = """
      [Log]
      Level = 'debug'
      JSONConsole = true

      [Telemetry]
      Enabled = true
      Endpoint = 'host.docker.internal:4317'
      ChipIngressEndpoint = 'chip-ingress:50051'
      InsecureConnection = true
      TraceSampleRatio = 1
      HeartbeatInterval = '30s'

      # Remove this bit to allow downloading workflows from remote sources
      [CRE.WorkflowFetcher]
      URL = "file:///home/chainlink/workflows"
      """

  [[nodesets.node_specs]]
    [nodesets.node_specs.node]
      docker_ctx = "../../../.."
      docker_file = "core/chainlink.Dockerfile"
      #image = "chainlink-tmp:latest"
      user_config_overrides = """
      [Log]
      Level = 'debug'
      JSONConsole = true

      [Telemetry]
      Enabled = true
      Endpoint = 'host.docker.internal:4317'
      ChipIngressEndpoint = 'chip-ingress:50051'
      InsecureConnection = true
      TraceSampleRatio = 1
      HeartbeatInterval = '30s'

      # Remove this bit to allow downloading workflows from remote sources
      [CRE.WorkflowFetcher]
      URL = "file:///home/chainlink/workflows"
      """

  [[nodesets.node_specs]]
    [nodesets.node_specs.node]
      docker_ctx = "../../../.."
      docker_file = "core/chainlink.Dockerfile"
      #image = "chainlink-tmp:latest"
      user_config_overrides = """
      [Log]
      Level = 'debug'
      JSONConsole = true

      [Telemetry]
      Enabled = true
      Endpoint = 'host.docker.internal:4317'
      ChipIngressEndpoint = 'chip-ingress:50051'
      InsecureConnection = true
      TraceSampleRatio = 1
      HeartbeatInterval = '30s'

      # Remove this bit to allow downloading workflows from remote sources
      [CRE.WorkflowFetcher]
      URL = "file:///home/chainlink/workflows"
      """

  [[nodesets.node_specs]]
    [nodesets.node_specs.node]
      docker_ctx = "../../../.."
      docker_file = "core/chainlink.Dockerfile"
      #image = "chainlink-tmp:latest"
      user_config_overrides = """
      [Log]
      Level = 'debug'
      JSONConsole = true

      [Telemetry]
      Enabled = true
      Endpoint = 'host.docker.internal:4317'
      ChipIngressEndpoint = 'chip-ingress:50051'
      InsecureConnection = true
      TraceSampleRatio = 1
      HeartbeatInterval = '30s'

      # Remove this bit to allow downloading workflows from remote sources
      [CRE.WorkflowFetcher]
      URL = "file:///home/chainlink/workflows"
      """